<!doctype html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thống kê hệ thống</title>
    <link rel="stylesheet" href="../src/styles/main.css">
    <link rel="stylesheet" href="../src/styles/pages.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>

<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Taskbar</h2>
            </div>
            <nav class="nav-menu">
                <a href="home-page.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Trang chủ</span>
                </a>
                <a href="sensor-data.html" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    <span>Dữ liệu cảm biến</span>
                </a>
                <a href="action-history.html" class="nav-item">
                    <i class="fas fa-history"></i>
                    <span>Lịch sử hoạt động</span>
                </a>
                <a href="statistics.html" class="nav-item active">
                    <i class="fas fa-chart-bar"></i>
                    <span>Thống kê</span>
                </a>
            </nav>
        </div>

        <div class="main-content">
            <div class="header">
                <div class="header-center">
                    <div class="page-title">
                        <h1>Thống kê hệ thống</h1>
                    </div>
                </div>
                <div class="header-right">
                    <div class="profile">
                        <div class="avatar" onclick="window.location.href='profile.html'">P</div>
                    </div>
                </div>
            </div>

            <div class="content statistics-page">
                <div id="threshold-stats-container">
                    <div class="stats-card threshold-stats-card">
                        <div class="stats-header">
                            <h3>Thống kê vượt ngưỡng trong ngày</h3>
                            <button id="thresholdSettingsBtn" class="threshold-settings-btn" title="Cài đặt ngưỡng">
                                <i class="fas fa-cog"></i>
                            </button>
                        </div>
                        <div class="stats-controls">
                            <input type="date" id="thresholdStatsDatePicker" class="date-picker" />
                            <button id="thresholdDebugBtn" class="debug-btn" title="Xem chi tiết">
                                <i class="fas fa-info-circle"></i>Chi tiết
                            </button>
                            <button id="thresholdStatsRefresh" class="refresh-btn">
                                <i class="fas fa-sync-alt"></i>Làm mới
                            </button>
                        </div>
                        <div class="threshold-stats-wrapper">
                            <div class="stats-loading" id="thresholdStatsLoading" style="display: none;">
                                <div class="loading-spinner"></div>
                                <p>Đang tải...</p>
                            </div>
                            <div class="threshold-stats-content" id="thresholdStatsContent">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="led-stats-container">
                    <div class="stats-card led-stats-card">
                        <div class="stats-header">
                            <h3>Thống kê lượt bật thiết bị trong ngày</h3>
                        </div>
                        <div class="stats-controls">
                            <input type="date" id="statsDatePicker" class="date-picker" />
                            <button id="statsRefresh" class="refresh-btn">
                                <i class="fas fa-sync-alt"></i>Làm mới
                            </button>
                        </div>
                        <div class="led-stats-wrapper">
                            <div class="stats-loading" id="statsLoading" style="display: none;">
                                <div class="loading-spinner"></div>
                                <p>Đang tải...</p>
                            </div>
                            <div class="led-stats-content" id="statsContent">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script type="module">
        import ThresholdSettingsPopup from '../src/components/threshold-settings-popup.js';
        import ThresholdStatsControl from '../src/control/threshold-stats-control.js';
        import LEDStatsPanelControl from '../src/control/led-stats-panel-control.js';

        const thresholdStatsControl = new ThresholdStatsControl('threshold-stats-container');
        thresholdStatsControl.initialize();

        const ledStatsControl = new LEDStatsPanelControl();
        ledStatsControl.load(false);
        ledStatsControl.startAutoRefresh(30000);

        const thresholdPopup = new ThresholdSettingsPopup(async () => {
            await thresholdStatsControl.loadThresholds();
            await thresholdStatsControl.loadStats(thresholdStatsControl.selectedDate);
        });
        
        const settingsBtn = document.getElementById('thresholdSettingsBtn');
        
        if (settingsBtn) {
            settingsBtn.addEventListener('click', () => {
                thresholdPopup.show();
            });
        }
    </script>
    <script src="../src/control/profile-control.js"></script>
</body>

</html>